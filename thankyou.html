<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>התשלום הושלם!</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Rubik:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        @keyframes fadeInModal { from { opacity: 0; transform: translateY(-20px) scale(0.98); } to { opacity: 1; transform: translateY(0) scale(1); } }
        body { font-family: 'Rubik', sans-serif; margin: 0; background-color: #f0f4f8; display: flex; justify-content: center; align-items: center; min-height: 100vh; padding: 20px; box-sizing: border-box; }
        .modal-container { background-color: white; padding: 30px 40px; border-radius: 16px; box-shadow: 0 20px 60px rgba(50, 50, 93, 0.15), 0 15px 35px rgba(0, 0, 0, 0.1); text-align: center; max-width: 480px; width: 100%; border: 1px solid #e6e9ee; animation: fadeInModal 0.6s ease-out forwards; }
        .icon-success { width: 80px; height: 80px; margin: 0 auto 20px auto; }
        .icon-success .circle { stroke-dasharray: 264; stroke-dashoffset: 264; animation: drawCircle 0.8s ease-out forwards; }
        .icon-success .checkmark { stroke-dasharray: 48; stroke-dashoffset: 48; animation: drawCheckmark 0.4s 0.5s ease-out forwards; }
        @keyframes drawCircle { to { stroke-dashoffset: 0; } }
        @keyframes drawCheckmark { to { stroke-dashoffset: 0; } }
        h1 { font-size: 2rem; font-weight: 700; color: #334155; margin-bottom: 15px; }
        p { font-size: 1.1rem; color: #64748b; line-height: 1.7; margin-bottom: 25px; }
        #countdown { font-weight: 700; font-size: 1.3rem; color: #435ebe; background-color: #f0f4ff; padding: 2px 8px; border-radius: 6px; }
        .fallback-link { margin-top: 30px; font-size: 0.9rem; color: #94a3b8; }
        .fallback-link a { color: #435ebe; text-decoration: none; font-weight: 500; }
    </style>
</head>
<body>
    <div class="modal-container">
        <svg class="icon-success" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100">
            <circle class="circle" cx="50" cy="50" r="42" fill="none" stroke="#27ae60" stroke-width="4"/>
            <path class="checkmark" fill="none" stroke="#27ae60" stroke-width="5" stroke-linecap="round" stroke-linejoin="round" d="M34,50 l12,12 l20,-20"/>
        </svg>
        <h1>התשלום הושלם בהצלחה!</h1>
        <p>תודה! אנו מעבירים אותך אל שאלון האבחון להתחלת התהליך.</p>
        <p>ההעברה תתבצע בעוד <span id="countdown">5</span> שניות...</p>
        <p class="fallback-link">אם ההעברה לא התבצעה, <a href="https://nzinok.github.io/shelon-ivchun/">לחץ כאן למעבר ידני</a>.</p>
    </div>

    <script>
        // כתובת ה-API של השרת שלך
        const SCRIPT_URL = "הדבק כאן את כתובת ה-API שלך";

        (function() {
            // 1. שמירת האימייל ב-Google Sheets
            // קריאת הפרמטר 'email' מכתובת ה-URL של הדף
            const urlParams = new URLSearchParams(window.location.search);
            const customerEmail = urlParams.get('email');

            // אם נמצא אימייל, שלח אותו לשרת
            if (customerEmail) {
                const requestBody = {
                    action: 'savePaidEmail', // הפעולה החדשה שיצרנו
                    payload: { email: customerEmail }
                };

                fetch(SCRIPT_URL, {
                    method: 'POST',
                    body: JSON.stringify(requestBody),
                    headers: { 'Content-Type': 'text/plain;charset=utf-8' }
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        console.log("Email saved successfully:", customerEmail);
                    } else {
                        console.error("Failed to save email:", data.message);
                    }
                })
                .catch(error => console.error("Error sending email to server:", error));
            }

            // 2. הפעלת הספירה לאחור (ללא שינוי)
            const questionnaireUrl = 'https://nzinok.github.io/shelon-ivchun/';
            let secondsLeft = 5;
            const countdownElement = document.getElementById('countdown');
            countdownElement.textContent = secondsLeft; // הצגה מיידית של המספר 5

            const timerInterval = setInterval(() => {
                secondsLeft--;
                countdownElement.textContent = secondsLeft;
                if (secondsLeft <= 0) {
                    clearInterval(timerInterval);
                    window.location.href = questionnaireUrl;
                }
            }, 1000);
        })();
    </script>
</body>
</html>
